<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Crystal & Stone Shop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  </head>
  <body>
    <!-- 3D Scene Container (Full Screen) -->
    <div id="threejs-container" class="threejs-container">
      <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
          <div class="spinner"></div>
          <p>Loading Virtual Crystal Shop...</p>
        </div>
      </div>
      
      <!-- 3D UI Overlays -->
      <div id="crystal-info-panel" class="crystal-info-panel">
        <button id="close-info-btn" class="close-info-btn">√ó</button>
        <h3>
          <span id="crystal-emoji" class="crystal-emoji">üíé</span>
          <span id="crystal-name">Crystal Name</span>
        </h3>
        <div id="crystal-meta" class="crystal-meta">Crystal ‚Ä¢ Color ‚Ä¢ Properties</div>
        <div id="crystal-price" class="crystal-price">$0.00</div>
        <div id="crystal-energy" class="crystal-energy"></div>
        <div class="crystal-info-actions">
          <button id="add-to-cart-3d" class="button">Add to Cart</button>
        </div>
      </div>
      
      <!-- Controls Help -->
      <div id="controls-help" class="controls-help">
        <h3>üîÆ Virtual Crystal Shop</h3>
        <div class="controls">
          <p><strong>Navigation:</strong></p>
          <ul>
            <li>üñ±Ô∏è <strong>Click arrows:</strong> Move between areas</li>
            <li>üñ±Ô∏è <strong>Click crystals:</strong> Examine and add to cart</li>
            <li>üñ•Ô∏è <strong>Click screen:</strong> Access store interface</li>
            <li>üìç <strong>Click hotspots:</strong> Explore different sections</li>
          </ul>
          <p><strong>Fractal Navigation:</strong></p>
          <ul>
            <li>üíé <strong>Approach crystals:</strong> Glow intensifies when close</li>
            <li>üñ±Ô∏è <strong>Click nearby crystal:</strong> Enter close-up view</li>
            <li>‚å®Ô∏è <strong>Number keys (1-0):</strong> Quick access to nearby crystals</li>
            <li>‚¨áÔ∏è <strong>Back arrow / Space:</strong> Exit close-up view</li>
          </ul>
          <p><strong>Keyboard Shortcuts:</strong></p>
          <ul>
            <li>‚å®Ô∏è <strong>Arrow keys:</strong> Navigate between areas</li>
            <li>‚å®Ô∏è <strong>H:</strong> Toggle help panel</li>
            <li>‚å®Ô∏è <strong>Escape:</strong> Close panels / Exit close-up</li>
            <li>‚å®Ô∏è <strong>Space:</strong> Exit crystal close-up</li>
          </ul>
          <p><strong>Current Location:</strong></p>
          <div id="location-indicator" class="location-indicator">Main Hall</div>
        </div>
        <button id="toggle-help" class="button">Hide Help</button>
      </div>
      
      <!-- Navigation Arrows -->
      <div id="navigation-arrows" class="navigation-arrows">
        <div id="nav-left" class="nav-arrow nav-left">‚óÄ</div>
        <div id="nav-right" class="nav-arrow nav-right">‚ñ∂</div>
        <div id="nav-forward" class="nav-arrow nav-forward">‚ñ≤</div>
        <div id="nav-back" class="nav-arrow nav-back">‚ñº</div>
      </div>
      
      <!-- Navigation Hotspots -->
      <div id="navigation-hotspots" class="navigation-hotspots">
        <div id="hotspot-crystals" class="hotspot" data-target="crystal-garden">üíé Crystal Garden</div>
        <div id="hotspot-screen" class="hotspot" data-target="computer-terminal">üñ•Ô∏è Computer Terminal</div>
        <div id="hotspot-entrance" class="hotspot" data-target="entrance">üö™ Entrance</div>
      </div>
      
      <!-- Mini Cart Display -->
      <div id="mini-cart" class="mini-cart">
        <div class="cart-icon">üõí</div>
        <div class="cart-count" id="cart-count">0</div>
        <div class="cart-total" id="cart-total">$0.00</div>
      </div>
    </div>

    <!-- Hidden 2D Interface (rendered to texture) -->
    <div id="virtual-2d-interface" class="virtual-2d-interface">
      <header class="site-header">
        <h1 class="site-title">Crystal & Stone Shop</h1>
        <div class="header-actions">
          <button id="closeVirtualStoreButton" class="button primary">Back to 3D</button>
        </div>
      </header>

      <main class="site-main">
        <section class="store-controls">
          <div class="control">
            <label for="searchInput">Search</label>
            <input id="searchInput" type="text" placeholder="Search by name, color, or energy..." />
          </div>
          <div class="control">
            <label for="categorySelect">Category</label>
            <select id="categorySelect">
              <option value="all">All</option>
              <option value="crystal">Crystals</option>
              <option value="stone">Stones</option>
            </select>
          </div>
          <div class="control">
            <label for="sortSelect">Sort</label>
            <select id="sortSelect">
              <option value="popularity">Popularity</option>
              <option value="price-asc">Price: Low to High</option>
              <option value="price-desc">Price: High to Low</option>
              <option value="name-asc">Name: A ‚Üí Z</option>
              <option value="name-desc">Name: Z ‚Üí A</option>
            </select>
          </div>
        </section>

        <section class="store-content">
          <div class="product-grid" id="productGrid" aria-live="polite"></div>
          <aside class="cart" aria-label="Cart">
            <h4>Cart</h4>
            <div id="cartItems" class="cart-items"></div>
            <div class="cart-footer">
              <div class="totals">
                <div class="row"><span>Subtotal</span><span id="subtotalAmount">$0.00</span></div>
                <div class="row"><span>Tax (7%)</span><span id="taxAmount">$0.00</span></div>
                <div class="row total"><span>Total</span><span id="totalAmount">$0.00</span></div>
              </div>
              <button id="checkoutButton" class="button primary" disabled>Checkout</button>
            </div>
          </aside>
        </section>
      </main>
    </div>

    <!-- Virtual Screen Overlay (when accessing the 2D interface) -->
    <div id="screen-overlay" class="screen-overlay hidden">
      <div class="virtual-screen-content">
        <button id="close-screen" class="close-screen">√ó</button>
        <div id="screen-content"></div>
      </div>
    </div>

    <script src="./app.js" type="module"></script>
  </body>
</html>